"use strict";const e=require("../../../../../../../common/vendor.js"),l=require("../../utils/create/component.js"),t=require("../popup/props.js");require("../../locale/index.js"),require("../../locale/lang/zh-CN.js"),require("../../locale/lang/baseLang.js"),require("../../locale/lang/en-US.js"),require("../../utils/util.js"),require("../overlay/props.js");const o=()=>"../popup/index.js",n=()=>"./Column.js",{componentName:a,create:r,translate:s}=l.createComponent("picker"),u=r({components:{[n.name]:n,[o.name]:o},props:{...t.popupProps,modelValue:{type:Array,default:()=>[]},title:{type:String,default:""},cancelText:{type:String,default:""},okText:{type:String,default:""},columns:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1},threeDimensional:{type:Boolean,default:!0}},emits:["close","change","confirm","update:visible","update:modelValue"],setup(l,{emit:t}){const o=e.reactive({show:!1,formattedColumns:l.columns});let r=e.ref(l.modelValue);e.ref();const u=e.computed((()=>({[a]:!0}))),c=e.computed((()=>{let e=[];return d.value.map(((l,t)=>{let o=[];o=l.filter((e=>e.value==r.value[t])),e.push(o[0])})),e})),i=e.computed((()=>{const e=o.formattedColumns[0];if(e){if(Array.isArray(e))return"multiple";if("children"in e)return"cascade"}return"single"})),d=e.computed((()=>{switch(i.value){case"multiple":return o.formattedColumns;case"cascade":return p(o.formattedColumns,r.value);default:return[o.formattedColumns]}})),p=(e,l)=>{const t=[];let o={text:"",value:"",children:e},n=0;for(;o&&o.children;){const e=o.children,a=l[n];let r=e.findIndex((e=>e.value==a));-1==r&&(r=0),o=o.children[r],n++,t.push(e)}return t};return e.onMounted((()=>{l.visible&&(o.show=l.visible)})),e.onBeforeUnmount((()=>{l.visible&&(o.show=!1)})),e.watch((()=>l.modelValue),(e=>{JSON.stringify(e)===JSON.stringify(r.value)||(r.value=e)}),{deep:!0}),e.watch(r,(e=>{JSON.stringify(e)===JSON.stringify(l.modelValue)||t("update:modelValue",e)}),{immediate:!0}),e.watch((()=>l.visible),(e=>{o.show=e})),e.watch((()=>l.columns),(e=>{console.log("更新 columes"),e.length&&(o.formattedColumns=e)})),{classes:u,...e.toRefs(o),column:n,columnsType:i,columnsList:d,close:()=>{t("close",{selectedValue:r.value,selectedOptions:c.value}),t("update:visible",!1)},changeHandler:(e,l)=>{if(l&&Object.keys(l).length){if("cascade"===i.value){r.value[e]=l.value?l.value:"";let t=e,o=l;for(;o&&o.children&&o.children[0];)r.value[t+1]=o.children[0].value,t++,o=o.children[0];o&&o.children&&0==o.children.length&&(r.value=r.value.slice(0,t+1))}else r.value[e]=l.hasOwnProperty("value")?l.value:"";t("change",{columnIndex:e,selectedValue:r.value,selectedOptions:c.value})}},confirmHandler:()=>{t("confirm",{selectedValue:r.value,selectedOptions:c.value}),t("update:visible",!1)},defaultValues:r,translate:s}}});if(!Array){(e.resolveComponent("nut-picker-column")+e.resolveComponent("nut-popup"))()}Math||((()=>"../pickercolumn/index.js")+(()=>"../popup/index.js"))();const c=e._export_sfc(u,[["render",function(l,t,o,n,a,r){return{a:e.t(l.cancelText||l.translate("cancel")),b:e.o(((...e)=>l.close&&l.close(...e))),c:e.t(l.title),d:e.t(l.okText||l.translate("confirm")),e:e.o((e=>l.confirmHandler())),f:e.f(l.columnsList,((t,o,n)=>({a:e.o((e=>{l.changeHandler(o,e)}),o),b:"2f730e02-1-"+n+",2f730e02-0",c:e.p({itemShow:l.show,column:t,readonly:l.readonly,columnsType:l.columnsType,value:l.defaultValues[o],threeDimensional:l.threeDimensional}),d:o}))),g:e.o(l.close),h:e.o((e=>l.show=e)),i:e.p({position:"bottom",teleport:l.teleport,"lock-scroll":l.lockScroll,"close-on-click-overlay":l.closeOnClickOverlay,round:!0,visible:l.show}),j:e.n(l.classes)}}]]);wx.createComponent(c);
