"use strict";const e=require("../../../../../../../common/vendor.js"),t=require("../../utils/create/component.js"),a=require("../../utils/useTouch/index.js");require("../../locale/index.js"),require("../../locale/lang/zh-CN.js"),require("../../locale/lang/baseLang.js"),require("../../locale/lang/en-US.js"),require("../../utils/util.js");const{create:n}=t.createComponent("picker-column"),o=n({props:{value:[String,Number],columnsType:String,itemShow:{type:Boolean,default:!1},column:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1},threeDimensional:{type:Boolean,default:!0}},emits:["click","change"],setup(t,{emit:n}){const o=a.useTouch(),l=e.ref(),r=e.reactive({touchParams:{startY:0,endY:0,startTime:0,endTime:0,lastY:0,lastTime:0},currIndex:1,transformY:0,scrollDistance:0,lineSpacing:36,rotation:20,timer:null}),s=e.ref(null),c=e.ref(null),u=e.ref(!1),i=e.ref(0),m=e.ref(0),h=e.computed((()=>({transition:`transform ${m.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`rotate3d(1, 0, 0, ${i.value})`}))),d=e.computed((()=>({transition:`transform ${m.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`translate3d(0, ${r.scrollDistance}px, 0)`}))),p=(e,t)=>e=Math.abs(e/t)/.003*(e<0?-1:1),f=(e=0,t,a=1e3,n)=>{m.value="end"===t?a:0,i.value=n,r.scrollDistance=e},g=(e,a,n)=>{let o=e+r.transformY;if("end"===a){o>0&&(o=0),o<-(t.column.length-1)*r.lineSpacing&&(o=-(t.column.length-1)*r.lineSpacing);let e=Math.round(o/r.lineSpacing)*r.lineSpacing,l=(Math.abs(Math.round(e/r.lineSpacing))+1)*r.rotation+"deg";f(e,a,n,l),r.currIndex=Math.abs(Math.round(e/r.lineSpacing))+1}else{let e=0,a=(-o/r.lineSpacing+1)*r.rotation;const n=(t.column.length+1)*r.rotation,l=0;e=Math.min(Math.max(a,l),n),l<e&&e<n&&(f(o,null,void 0,e+"deg"),r.currIndex=Math.abs(Math.round(o/r.lineSpacing))+1)}},v=()=>{n("change",t.column[r.currIndex-1])},S=e=>{const{column:a}=t;let n=a.findIndex((e=>e.value==t.value));r.currIndex=-1===n?1:n+1;let o=-1===n?0:n*r.lineSpacing;e&&v(),g(-o)},x=(e,t)=>{("boolean"!=typeof e.cancelable||e.cancelable)&&e.preventDefault(),t&&e.stopPropagation()};return e.watch((()=>t.column),(e=>{t.column&&t.column.length>0&&(r.transformY=0,S(!1))}),{deep:!0}),e.watch((()=>t.value),(e=>{r.transformY=0,S(!1)}),{deep:!0}),e.onMounted((()=>{S(!0)})),{...e.toRefs(r),...e.toRefs(t),wrapper:l,setRollerStyle:e=>`transform: rotate3d(1, 0, 0, ${-r.rotation*e}deg) translate3d(0px, 0px, 104px)`,isHidden:e=>e>=r.currIndex+8||e<=r.currIndex-8,roller:s,list:c,onTouchStart:e=>{if(o.start(e),u.value){let e=c.value;t.threeDimensional||(e=s.value);const{transform:a}=window.getComputedStyle(e);r.scrollDistance=+a.slice(7,a.length-1).split(", ")[5]}r.touchParams.startY=o.deltaY.value,r.touchParams.startTime=Date.now(),r.transformY=r.scrollDistance},onTouchMove:e=>{o.move(e),o.isVertical&&(u.value=!0,x(e,!0)),r.touchParams.lastY=o.deltaY.value;let t=r.touchParams.lastY-r.touchParams.startY;g(t)},onTouchEnd:e=>{r.touchParams.lastY=o.deltaY.value,r.touchParams.lastTime=Date.now();let t=r.touchParams.lastY-r.touchParams.startY,a=r.touchParams.lastTime-r.touchParams.startTime;if(a<=300&&Math.abs(t)>15){const e=p(t,a);g(e,"end",a+1e3)}else g(t,"end"),setTimeout((()=>{o.reset(),u.value=!1}),0)},touchRollerStyle:h,touchTileStyle:d,setMove:g,stopMomentum:()=>{u.value=!1,v()}}}});const l=e._export_sfc(o,[["render",function(t,a,n,o,l,r){return e.e({a:e.f(t.column,((a,n,o)=>e.e({a:a&&a.text&&t.threeDimensional},a&&a.text&&t.threeDimensional?{b:e.t(a.text),c:t.isHidden(n+1)?1:"",d:e.s(t.setRollerStyle(n+1))}:{},{e:a&&a.text&&!t.threeDimensional},a&&a.text&&!t.threeDimensional?{f:e.t(a.text)}:{},{g:a.value?a.value:n}))),b:e.s(t.threeDimensional?t.touchRollerStyle:t.touchTileStyle),c:e.o(((...e)=>t.stopMomentum&&t.stopMomentum(...e))),d:t.threeDimensional},t.threeDimensional?{e:e.s(t.touchTileStyle)}:{},{f:e.o(((...e)=>t.onTouchStart&&t.onTouchStart(...e))),g:e.o(((...e)=>t.onTouchMove&&t.onTouchMove(...e))),h:e.o(((...e)=>t.onTouchEnd&&t.onTouchEnd(...e)))})}]]);wx.createComponent(l);
