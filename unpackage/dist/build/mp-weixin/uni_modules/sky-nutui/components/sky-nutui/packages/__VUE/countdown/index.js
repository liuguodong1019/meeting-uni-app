"use strict";const e=require("../../../../../../../common/vendor.js"),t=require("../../utils/create/component.js"),n=require("./util.js");require("../../locale/index.js"),require("../../locale/lang/zh-CN.js"),require("../../locale/lang/baseLang.js"),require("../../locale/lang/en-US.js"),require("../../utils/util.js");const{componentName:r,create:a,translate:o}=t.createComponent("countdown"),i=a({props:{modelValue:{type:Object,default:()=>({})},paused:{default:!1,type:Boolean},startTime:{type:[Number,String],validator:e=>"invalid date"!==new Date(e).toString().toLowerCase()},endTime:{type:[Number,String],validator:e=>"invalid date"!==new Date(e).toString().toLowerCase()},millisecond:{default:!1,type:Boolean},format:{type:String,default:"HH:mm:ss"},autoStart:{type:Boolean,default:!0},time:{type:[Number,String],default:0}},emits:["input","on-end","on-restart","on-paused","update:modelValue"],setup(t,{emit:a,slots:i}){const s=e.reactive({restTime:0,timer:null,counting:!t.paused&&t.autoStart,handleEndTime:Date.now(),diffTime:0}),l=e.computed((()=>({[r]:!0}))),m=e.computed((()=>c(s.restTime))),u=()=>{s.handleEndTime=t.endTime,s.diffTime=Date.now()-n.getTimeStamp(t.startTime),s.counting||(s.counting=!0),d()},d=()=>{s.timer=setInterval((()=>{if(s.counting){const e=Date.now()-s.diffTime,t=Math.max(s.handleEndTime-e,0);s.restTime=t,t||(s.counting=!1,S(),a("on-end"))}}),1)},c=(e,t)=>{const n=e;let r={d:0,h:0,m:0,s:0,ms:0};const a=1e3,o=6e4,i=36e5,s=24*i;return n>0&&(r.d=n>=a?Math.floor(n/s):0,r.h=Math.floor(n%s/i),r.m=Math.floor(n%i/o),r.s=Math.floor(n%o/a),r.ms=Math.floor(n%a)),"custom"==t?r:p({...r})},p=e=>{let{d:r,h:a,m:o,s:i,ms:s}=e,l=t.format;if(l.includes("DD")?l=l.replace("DD",n.padZero(r)):a+=24*Number(r),l.includes("HH")?l=l.replace("HH",n.padZero(a)):o+=60*Number(a),l.includes("mm")?l=l.replace("mm",n.padZero(o)):i+=60*Number(o),l.includes("ss")?l=l.replace("ss",n.padZero(i)):s+=1e3*Number(i),l.includes("S")){const e=n.padZero(s,3).toString();l.includes("SSS")?l=l.replace("SSS",e):l.includes("SS")?l=l.replace("SS",e.slice(0,2)):l.includes("S")&&(l=l.replace("SS",e.slice(0,1)))}return l},S=()=>{clearInterval(s.timer),s.counting=!1,a("on-paused",s.restTime)};return e.onMounted((()=>{t.autoStart?u():s.restTime=t.time})),e.onUnmounted((()=>{s.timer&&clearInterval(s.timer)})),e.watch((()=>s.restTime),(e=>{let t=c(e,"custom");a("update:modelValue",t),a("input",t)})),e.watch((()=>t.paused),((e,t)=>{t?(s.counting||(s.counting=!0,s.handleEndTime=Date.now()+Number(s.restTime),d()),a("on-restart",s.restTime)):s.counting&&S()})),e.watch((()=>t.endTime),(e=>{u()})),e.watch((()=>t.startTime),(e=>{u()})),{...e.toRefs(t),slots:i,classes:l,getTimeStamp:n.getTimeStamp,start:()=>{s.counting||t.autoStart||(s.counting=!0,s.handleEndTime=Date.now()+Number(s.restTime),d(),a("on-restart",s.restTime))},pause:S,renderTime:m,translate:o,reset:()=>{t.autoStart||(S(),s.restTime=t.time)}}}});const s=e._export_sfc(i,[["render",function(t,n,r,a,o,i){return e.e({a:t.slots.default},t.slots.default?{}:{b:t.renderTime},{c:e.n(t.classes)})}]]);wx.createComponent(s);
