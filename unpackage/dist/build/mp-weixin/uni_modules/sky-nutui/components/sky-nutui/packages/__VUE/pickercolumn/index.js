"use strict";const e=require("../../../../../../../common/vendor.js"),t=require("../../utils/create/component.js"),a=require("../../utils/useTouch/index.js");require("../../locale/index.js"),require("../../locale/lang/zh-CN.js"),require("../../locale/lang/baseLang.js"),require("../../locale/lang/en-US.js"),require("../../utils/util.js");const{create:o}=t.createComponent("picker-column"),n=o({props:{value:[String,Number],columnsType:String,itemShow:{type:Boolean,default:!1},column:{type:Array,default:()=>[]},readonly:{type:Boolean,default:!1},threeDimensional:{type:Boolean,default:!0}},emits:["click","change"],setup(t,{emit:o}){const n=a.useTouch(),r=e.ref(),l=e.ref(),s=e.reactive({touchParams:{startY:0,endY:0,startTime:0,endTime:0,lastY:0,lastTime:0},currIndex:1,transformY:0,scrollDistance:0,lineSpacing:36,rotation:20,timer:null}),c=e.ref(null),u=e.ref(null),i=e.ref(null),m=e.ref(!1),d=e.ref(0),h=e.ref(0),p=e.ref(0),f=e.computed((()=>({transition:`transform ${h.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`translate3d(0, ${s.scrollDistance}px, 0)`}))),g=e.computed((()=>({transition:`transform ${h.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`rotate3d(1, 0, 0, ${d.value})`}))),v=(e,t)=>e=Math.abs(e/t)/.003*(e<0?-1:1),S=(e=0,t,a=1e3,o)=>{h.value="end"===t?a:0,d.value=o,p.value=e,s.scrollDistance=e},T=(e,a,o)=>{let n=e+s.transformY;if("end"===a){n>0&&(n=0),n<-(t.column.length-1)*s.lineSpacing&&(n=-(t.column.length-1)*s.lineSpacing);let e=Math.round(n/s.lineSpacing)*s.lineSpacing,r=(Math.abs(Math.round(e/s.lineSpacing))+1)*s.rotation+"deg";S(e,a,o,r),s.currIndex=Math.abs(Math.round(e/s.lineSpacing))+1}else{let e=0,a=(-n/s.lineSpacing+1)*s.rotation;const o=(t.column.length+1)*s.rotation,r=0;e=Math.min(Math.max(a,r),o),r<e&&e<o&&(S(n,null,void 0,e+"deg"),s.currIndex=Math.abs(Math.round(n/s.lineSpacing))+1)}},M=()=>{o("change",t.column[s.currIndex-1])},Y=e=>{const{column:a}=t;let o=a.findIndex((e=>e.value==t.value));s.currIndex=-1===o?1:o+1;let n=-1===o?0:o*s.lineSpacing;e&&M(),T(-n)},x=(e,t)=>{("boolean"!=typeof e.cancelable||e.cancelable)&&e.preventDefault(),t&&e.stopPropagation()},b=async()=>{Y(!0)};e.watch((()=>t.column),(e=>{s.transformY=0,Y(!1)}),{deep:!0}),e.watch((()=>t.value),(e=>{s.transformY=0,Y(!1)}),{deep:!0}),e.watch((()=>t.itemShow),(e=>{e?setTimeout((()=>{b()}),200):s.transformY=0}),{deep:!0}),e.onMounted((()=>{setTimeout((()=>{b()}),200)}));const y=Math.random().toString(36).slice(-8);return{...e.toRefs(s),...e.toRefs(t),wrapper:r,itemref:l,setRollerStyle:e=>`transform: rotate3d(1, 0, 0, ${-s.rotation*e}deg) translate3d(0px, 0px, 104px)`,isHidden:e=>e>=s.currIndex+8||e<=s.currIndex-8,roller:c,list:u,listitem:i,onTouchStart:e=>{n.start(e),m.value,s.touchParams.startY=n.deltaY.value,s.touchParams.startTime=Date.now(),s.transformY=s.scrollDistance},onTouchMove:e=>{n.move(e),n.isVertical&&(m.value=!0,x(e,!0)),s.touchParams.lastY=n.deltaY.value;let t=s.touchParams.lastY-s.touchParams.startY;T(t)},onTouchEnd:e=>{s.touchParams.lastY=n.deltaY.value,s.touchParams.lastTime=Date.now();let t=s.touchParams.lastY-s.touchParams.startY,a=s.touchParams.lastTime-s.touchParams.startTime;if(a<=300&&Math.abs(t)>15){const e=v(t,a);T(e,"end",a+1e3)}else T(t,"end"),setTimeout((()=>{n.reset(),m.value=!1}),0)},touchTileStyle:g,touchListStyle:f,setMove:T,refRandomId:y,stopMomentum:()=>{m.value=!1,console.log("滚动结束"),M()}}}});const r=e._export_sfc(n,[["render",function(t,a,o,n,r,l){return{a:e.f(t.column,((a,o,n)=>({a:e.t(a.text),b:t.isHidden(o+1)?1:"",c:e.s(t.setRollerStyle(o+1)),d:a.value?a.value:o}))),b:e.s(t.touchTileStyle),c:e.o(((...e)=>t.stopMomentum&&t.stopMomentum(...e))),d:"list"+t.refRandomId,e:e.s(t.touchListStyle),f:e.o(((...e)=>t.onTouchStart&&t.onTouchStart(...e))),g:e.o(((...e)=>t.onTouchMove&&t.onTouchMove(...e))),h:e.o(((...e)=>t.onTouchEnd&&t.onTouchEnd(...e)))}}]]);wx.createComponent(r);
