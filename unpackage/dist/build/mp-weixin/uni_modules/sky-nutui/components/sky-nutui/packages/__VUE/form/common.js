"use strict";const e=require("../../utils/util.js"),r=require("../../../../../../../common/vendor.js"),t={props:{modelValue:{type:Object,default:{}}},components:{},emits:["validate"],setup(t,{emit:o,slots:l}){const s=r.computed((()=>r.reactive({})));r.provide("formErrorTip",s);const i=r.ref([]);r.provide("addNode",(e=>{i.value.push(e)}));const n=(e=t.modelValue)=>{Object.keys(s.value).forEach((e=>{s.value[e]=""}))};r.watch((()=>t.modelValue),(e=>{n(e)}),{immediate:!0});const a=r=>{let t=[];return r.forEach(((r,o)=>{var l,s,i,n;let u=r.type;u=u.name||u,"nut-form-item"==u?t.push({prop:null==(l=r.props)?void 0:l.prop,rules:(null==(s=r.props)?void 0:s.rules)||[]}):Array.isArray(r.children)&&(null==(i=r.children)?void 0:i.length)?t=t.concat(a(r.children)):e.isObject(r.children)&&Object.keys(r.children)&&(null==(n=r.children)?void 0:n.default)&&(r.children=r.children.default(),t=t.concat(a(r.children)))})),t},u=e=>{e.message&&o("validate",e),s.value[e.prop]=e.message},p=r=>{const{rules:o,prop:l}=r,s=e=>new Promise(((r,t)=>{u(e),r(e)}));l||console.warn("[NutUI] <FormItem> 使用 rules 校验规则时 , 必须设置 prop 参数");let i=e.getPropByPath(t.modelValue,l||"");u({prop:l,message:""});let n=[...o];for(;n.length;){const{required:r,validator:t,regex:o,message:a}=n.shift(),p={prop:l,message:a};if(r&&!i)return s(p);if(o&&!o.test(String(i)))return s(p);if(t){const r=t(i);if(e.isPromise(r))return new Promise(((e,t)=>{r.then((r=>{r?e(!0):(u(p),e(p))}))}));if(!r)return s(p)}}return Promise.resolve(!0)},c=(e="")=>new Promise(((r,t)=>{let o=a(i.value).map((r=>e?e==r.prop?p(r):Promise.resolve(!0):p(r)));Promise.all(o).then((e=>{const t={valid:!0,errors:[]};(e=e.filter((e=>1!=e))).length&&(t.valid=!1,t.errors=e),r(t)}))}));return{validate:c,reset:()=>{n()},onSubmit:()=>(c(),!1),formErrorTip:s}}};exports.component=t;
